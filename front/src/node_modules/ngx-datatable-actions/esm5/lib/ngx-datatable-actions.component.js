/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { Router } from '@angular/router';
var NgxDatatableActionsComponent = /** @class */ (function () {
    function NgxDatatableActionsComponent(router) {
        this.router = router;
        this.visibleColumns = [];
        this.cacheData = false;
        this.allColumns = [];
    }
    /**
     * @return {?}
     */
    NgxDatatableActionsComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        if (this.datatable && this.datatable['ngx-datatable-actions']) {
            this.allColumns = this.datatable['ngx-datatable-actions'];
        }
        else {
            var _loop_1 = function (col) {
                col['visible'] = true;
                col['fixed'] = false;
                this_1.visibleColumns.forEach(function (item) {
                    if (col.prop === item) {
                        col['visible'] = false;
                    }
                });
                this_1.allColumns.push(col);
            };
            var this_1 = this;
            try {
                for (var _b = tslib_1.__values(this.datatable.bodyComponent.columns), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var col = _c.value;
                    _loop_1(col);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
            this.setTableColumn();
            if (this.cacheData === true) {
                this.loadCacheData();
            }
        }
    };
    /**
     * @return {?}
     */
    NgxDatatableActionsComponent.prototype.ngAfterViewChecked = /**
     * @return {?}
     */
    function () {
        if (this.datatable && this.datatable['ngx-datatable-actions']) {
            this.allColumns = this.datatable['ngx-datatable-actions'];
        }
    };
    /**
     * @param {?} column
     * @return {?}
     */
    NgxDatatableActionsComponent.prototype.toggleVisible = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        column['visible'] = !column['visible'];
        this.setTableColumn();
    };
    /**
     * @param {?} column
     * @return {?}
     */
    NgxDatatableActionsComponent.prototype.pinningVisible = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        column['fixed'] = !column['fixed'];
        this.allColumns[this.allColumns.indexOf(column)].frozenLeft = column['fixed'];
        this.setTableColumn();
    };
    /**
     * @private
     * @return {?}
     */
    NgxDatatableActionsComponent.prototype.setTableColumn = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var columns = this.allColumns.filter(function (c) {
            return c['visible'];
        });
        this.datatable.columns = columns;
        this.datatable['ngx-datatable-actions'] = this.allColumns;
        if (this.cacheData === true) {
            this.cacheColumn();
        }
    };
    /**
     * @private
     * @return {?}
     */
    NgxDatatableActionsComponent.prototype.loadCacheData = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var vcns = [];
        /** @type {?} */
        var fcns = [];
        /** @type {?} */
        var cache = sessionStorage.getItem(this.router.url + '|dt');
        if (cache != null) {
            /** @type {?} */
            var colns = JSON.parse(cache);
            vcns = colns[0].split(',');
            fcns = colns[1].split(',');
            this.allColumns.forEach(function (c) {
                if (vcns.length > 0 && c.name && vcns.indexOf(c.name) === -1) {
                    c['visible'] = false;
                }
                if (fcns.length > 0 && fcns.indexOf(c.name) > -1) {
                    c['fixed'] = true;
                    c.frozenLeft = true;
                }
            });
        }
        this.setTableColumn();
    };
    /**
     * @private
     * @return {?}
     */
    NgxDatatableActionsComponent.prototype.cacheColumn = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var vcol = [];
        /** @type {?} */
        var fcol = [];
        /** @type {?} */
        var columns = this.allColumns.filter(function (c) {
            return (c['visible'] || c['fixed']) && c.name;
        });
        columns.forEach(function (c) {
            if (c['visible']) {
                vcol.push(c.name);
            }
            if (c['fixed']) {
                fcol.push(c.name);
            }
        });
        if (vcol || fcol) {
            /** @type {?} */
            var value = JSON.stringify([vcol.join(','), fcol.join(',')]);
            sessionStorage.setItem(this.router.url + '|dt', value);
        }
        else {
            sessionStorage.removeItem(this.router.url + '|dt');
        }
    };
    NgxDatatableActionsComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-datatable-actions',
                    template: "\n  <div class=\"dropdown d-inline\">\n    <a href=\"#\" class=\"btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill\"\n      data-toggle=\"dropdown\" aria-expanded=\"false\">\n      <i class=\"la la-ellipsis-h\"></i>\n    </a>\n    <div class=\"dropdown-menu dropdown-menu-right\" x-placement=\"bottom-end\">\n      <ng-container *ngFor=\"let col of allColumns\">\n        <div *ngIf=\"col.name && col.name!=null && col.name!=''\" class=\"dropdown-item\">\n          <a class=\"m-link\" title=\"\u53EF\u89C1\" (click)=\"toggleVisible(col)\">\n            <i class=\"la la-check\" [ngClass]=\"{'m--font-focus': col['visible'], 'm--font-metal': !col['visible']}\"></i>\n          </a>\n          <a class=\"m-link\" title=\"\u56FA\u5B9A\" (click)=\"pinningVisible(col)\">\n            <i class=\"la la-thumb-tack\" [ngClass]=\"{'m--font-focus': col['fixed'], 'm--font-metal': !col['fixed']}\"></i>\n          </a>\n          <span class=\"inline\">{{col.name}}</span>\n        </div>\n      </ng-container>\n    </div>\n  </div>"
                }] }
    ];
    /** @nocollapse */
    NgxDatatableActionsComponent.ctorParameters = function () { return [
        { type: Router }
    ]; };
    NgxDatatableActionsComponent.propDecorators = {
        datatable: [{ type: Input }],
        visibleColumns: [{ type: Input }],
        cacheData: [{ type: Input }]
    };
    return NgxDatatableActionsComponent;
}());
export { NgxDatatableActionsComponent };
if (false) {
    /** @type {?} */
    NgxDatatableActionsComponent.prototype.datatable;
    /** @type {?} */
    NgxDatatableActionsComponent.prototype.visibleColumns;
    /** @type {?} */
    NgxDatatableActionsComponent.prototype.cacheData;
    /** @type {?} */
    NgxDatatableActionsComponent.prototype.allColumns;
    /**
     * @type {?}
     * @private
     */
    NgxDatatableActionsComponent.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWRhdGF0YWJsZS1hY3Rpb25zLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1kYXRhdGFibGUtYWN0aW9ucy8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtZGF0YXRhYmxlLWFjdGlvbnMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQW9CLE1BQU0sZUFBZSxDQUFDO0FBQzNFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV6QztJQThCRSxzQ0FBb0IsTUFBYztRQUFkLFdBQU0sR0FBTixNQUFNLENBQVE7UUFMekIsbUJBQWMsR0FBYSxFQUFFLENBQUM7UUFDOUIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUUzQixlQUFVLEdBQVUsRUFBRSxDQUFDO0lBRWUsQ0FBQzs7OztJQUV2QywrQ0FBUTs7O0lBQVI7O1FBQ0UsSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsdUJBQXVCLENBQUMsRUFBRTtZQUM3RCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsdUJBQXVCLENBQUMsQ0FBQztTQUMzRDthQUFNO29DQUNNLEdBQUc7Z0JBQ1osR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDdEIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQztnQkFFckIsT0FBSyxjQUFjLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSTtvQkFDL0IsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLElBQUksRUFBRTt3QkFDckIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEtBQUssQ0FBQztxQkFDeEI7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsT0FBSyxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzVCLENBQUM7OztnQkFYRCxLQUFrQixJQUFB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QUssQ0FBQyxDQUFDO1NBQ3BEO0lBQ0gsQ0FBQzs7Z0JBNUhGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsdUJBQXVCO29CQUNqQyxRQUFRLEVBQUUsdWhDQW1CSDtpQkFDUjs7OztnQkF4QlEsTUFBTTs7OzRCQTBCWixLQUFLO2lDQUNMLEtBQUs7NEJBQ0wsS0FBSzs7SUFvR1IsbUNBQUM7Q0FBQSxBQTlIRCxJQThIQztTQXZHWSw0QkFBNEI7OztJQUN2QyxpREFBd0I7O0lBQ3hCLHNEQUF1Qzs7SUFDdkMsaURBQTJCOztJQUUzQixrREFBdUI7Ozs7O0lBRVgsOENBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBBZnRlclZpZXdDaGVja2VkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhcHAtZGF0YXRhYmxlLWFjdGlvbnMnLFxuICB0ZW1wbGF0ZTogYFxuICA8ZGl2IGNsYXNzPVwiZHJvcGRvd24gZC1pbmxpbmVcIj5cbiAgICA8YSBocmVmPVwiI1wiIGNsYXNzPVwiYnRuIG0tYnRuIG0tYnRuLS1ob3Zlci1icmFuZCBtLWJ0bi0taWNvbiBtLWJ0bi0taWNvbi1vbmx5IG0tYnRuLS1waWxsXCJcbiAgICAgIGRhdGEtdG9nZ2xlPVwiZHJvcGRvd25cIiBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIj5cbiAgICAgIDxpIGNsYXNzPVwibGEgbGEtZWxsaXBzaXMtaFwiPjwvaT5cbiAgICA8L2E+XG4gICAgPGRpdiBjbGFzcz1cImRyb3Bkb3duLW1lbnUgZHJvcGRvd24tbWVudS1yaWdodFwiIHgtcGxhY2VtZW50PVwiYm90dG9tLWVuZFwiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgY29sIG9mIGFsbENvbHVtbnNcIj5cbiAgICAgICAgPGRpdiAqbmdJZj1cImNvbC5uYW1lICYmIGNvbC5uYW1lIT1udWxsICYmIGNvbC5uYW1lIT0nJ1wiIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiPlxuICAgICAgICAgIDxhIGNsYXNzPVwibS1saW5rXCIgdGl0bGU9XCLlj6/op4FcIiAoY2xpY2spPVwidG9nZ2xlVmlzaWJsZShjb2wpXCI+XG4gICAgICAgICAgICA8aSBjbGFzcz1cImxhIGxhLWNoZWNrXCIgW25nQ2xhc3NdPVwieydtLS1mb250LWZvY3VzJzogY29sWyd2aXNpYmxlJ10sICdtLS1mb250LW1ldGFsJzogIWNvbFsndmlzaWJsZSddfVwiPjwvaT5cbiAgICAgICAgICA8L2E+XG4gICAgICAgICAgPGEgY2xhc3M9XCJtLWxpbmtcIiB0aXRsZT1cIuWbuuWumlwiIChjbGljayk9XCJwaW5uaW5nVmlzaWJsZShjb2wpXCI+XG4gICAgICAgICAgICA8aSBjbGFzcz1cImxhIGxhLXRodW1iLXRhY2tcIiBbbmdDbGFzc109XCJ7J20tLWZvbnQtZm9jdXMnOiBjb2xbJ2ZpeGVkJ10sICdtLS1mb250LW1ldGFsJzogIWNvbFsnZml4ZWQnXX1cIj48L2k+XG4gICAgICAgICAgPC9hPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaW5saW5lXCI+e3tjb2wubmFtZX19PC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5gXG59KVxuZXhwb3J0IGNsYXNzIE5neERhdGF0YWJsZUFjdGlvbnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0NoZWNrZWQge1xuICBASW5wdXQoKSBkYXRhdGFibGU6IGFueTtcbiAgQElucHV0KCkgdmlzaWJsZUNvbHVtbnM6IHN0cmluZ1tdID0gW107XG4gIEBJbnB1dCgpIGNhY2hlRGF0YSA9IGZhbHNlO1xuXG4gIGFsbENvbHVtbnM6IGFueVtdID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZXI6IFJvdXRlcikgeyB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKHRoaXMuZGF0YXRhYmxlICYmIHRoaXMuZGF0YXRhYmxlWyduZ3gtZGF0YXRhYmxlLWFjdGlvbnMnXSkge1xuICAgICAgdGhpcy5hbGxDb2x1bW5zID0gdGhpcy5kYXRhdGFibGVbJ25neC1kYXRhdGFibGUtYWN0aW9ucyddO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGNvbnN0IGNvbCBvZiB0aGlzLmRhdGF0YWJsZS5ib2R5Q29tcG9uZW50LmNvbHVtbnMpIHtcbiAgICAgICAgY29sWyd2aXNpYmxlJ10gPSB0cnVlO1xuICAgICAgICBjb2xbJ2ZpeGVkJ10gPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnZpc2libGVDb2x1bW5zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICBpZiAoY29sLnByb3AgPT09IGl0ZW0pIHtcbiAgICAgICAgICAgIGNvbFsndmlzaWJsZSddID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFsbENvbHVtbnMucHVzaChjb2wpO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRUYWJsZUNvbHVtbigpO1xuICAgICAgaWYgKHRoaXMuY2FjaGVEYXRhID09PSB0cnVlKSB7XG4gICAgICAgIHRoaXMubG9hZENhY2hlRGF0YSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICBpZiAodGhpcy5kYXRhdGFibGUgJiYgdGhpcy5kYXRhdGFibGVbJ25neC1kYXRhdGFibGUtYWN0aW9ucyddKSB7XG4gICAgICB0aGlzLmFsbENvbHVtbnMgPSB0aGlzLmRhdGF0YWJsZVsnbmd4LWRhdGF0YWJsZS1hY3Rpb25zJ107XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlVmlzaWJsZShjb2x1bW46IGFueSk6IHZvaWQge1xuICAgIGNvbHVtblsndmlzaWJsZSddID0gIWNvbHVtblsndmlzaWJsZSddO1xuICAgIHRoaXMuc2V0VGFibGVDb2x1bW4oKTtcbiAgfVxuXG4gIHBpbm5pbmdWaXNpYmxlKGNvbHVtbjogYW55KTogdm9pZCB7XG4gICAgY29sdW1uWydmaXhlZCddID0gIWNvbHVtblsnZml4ZWQnXTtcbiAgICB0aGlzLmFsbENvbHVtbnNbdGhpcy5hbGxDb2x1bW5zLmluZGV4T2YoY29sdW1uKV0uZnJvemVuTGVmdCA9IGNvbHVtblsnZml4ZWQnXTtcbiAgICB0aGlzLnNldFRhYmxlQ29sdW1uKCk7XG4gIH1cblxuICBwcml2YXRlIHNldFRhYmxlQ29sdW1uKCkge1xuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmFsbENvbHVtbnMuZmlsdGVyKGMgPT4ge1xuICAgICAgcmV0dXJuIGNbJ3Zpc2libGUnXTtcbiAgICB9KTtcbiAgICB0aGlzLmRhdGF0YWJsZS5jb2x1bW5zID0gY29sdW1ucztcbiAgICB0aGlzLmRhdGF0YWJsZVsnbmd4LWRhdGF0YWJsZS1hY3Rpb25zJ10gPSB0aGlzLmFsbENvbHVtbnM7XG4gICAgaWYgKHRoaXMuY2FjaGVEYXRhID09PSB0cnVlKSB7XG4gICAgICB0aGlzLmNhY2hlQ29sdW1uKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBsb2FkQ2FjaGVEYXRhKCkge1xuICAgIGxldCB2Y25zOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBmY25zOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IGNhY2hlID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnJvdXRlci51cmwgKyAnfGR0Jyk7XG4gICAgaWYgKGNhY2hlICE9IG51bGwpIHtcbiAgICAgIGNvbnN0IGNvbG5zID0gSlNPTi5wYXJzZShjYWNoZSk7XG4gICAgICB2Y25zID0gY29sbnNbMF0uc3BsaXQoJywnKTtcbiAgICAgIGZjbnMgPSBjb2xuc1sxXS5zcGxpdCgnLCcpO1xuICAgICAgdGhpcy5hbGxDb2x1bW5zLmZvckVhY2goYyA9PiB7XG4gICAgICAgIGlmICh2Y25zLmxlbmd0aCA+IDAgJiYgYy5uYW1lICYmIHZjbnMuaW5kZXhPZihjLm5hbWUpID09PSAtMSkge1xuICAgICAgICAgIGNbJ3Zpc2libGUnXSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmY25zLmxlbmd0aCA+IDAgJiYgZmNucy5pbmRleE9mKGMubmFtZSkgPiAtMSkge1xuICAgICAgICAgIGNbJ2ZpeGVkJ10gPSB0cnVlO1xuICAgICAgICAgIGMuZnJvemVuTGVmdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLnNldFRhYmxlQ29sdW1uKCk7XG4gIH1cblxuICBwcml2YXRlIGNhY2hlQ29sdW1uKCkge1xuICAgIGNvbnN0IHZjb2w6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgZmNvbDogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5hbGxDb2x1bW5zLmZpbHRlcihjID0+IHtcbiAgICAgIHJldHVybiAoY1sndmlzaWJsZSddIHx8IGNbJ2ZpeGVkJ10pICYmIGMubmFtZTtcbiAgICB9KTtcbiAgICBjb2x1bW5zLmZvckVhY2goYyA9PiB7XG4gICAgICBpZiAoY1sndmlzaWJsZSddKSB7XG4gICAgICAgIHZjb2wucHVzaChjLm5hbWUpO1xuICAgICAgfVxuICAgICAgaWYgKGNbJ2ZpeGVkJ10pIHtcbiAgICAgICAgZmNvbC5wdXNoKGMubmFtZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHZjb2wgfHwgZmNvbCkge1xuICAgICAgY29uc3QgdmFsdWUgPSBKU09OLnN0cmluZ2lmeShbdmNvbC5qb2luKCcsJyksIGZjb2wuam9pbignLCcpXSk7XG4gICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHRoaXMucm91dGVyLnVybCArICd8ZHQnLCB2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5yb3V0ZXIudXJsICsgJ3xkdCcpO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=