/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { Router } from '@angular/router';
export class NgxDatatableActionsComponent {
    /**
     * @param {?} router
     */
    constructor(router) {
        this.router = router;
        this.visibleColumns = [];
        this.cacheData = false;
        this.allColumns = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.datatable && this.datatable['ngx-datatable-actions']) {
            this.allColumns = this.datatable['ngx-datatable-actions'];
        }
        else {
            for (const col of this.datatable.bodyComponent.columns) {
                col['visible'] = true;
                col['fixed'] = false;
                this.visibleColumns.forEach((item) => {
                    if (col.prop === item) {
                        col['visible'] = false;
                    }
                });
                this.allColumns.push(col);
            }
            this.setTableColumn();
            if (this.cacheData === true) {
                this.loadCacheData();
            }
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
        if (this.datatable && this.datatable['ngx-datatable-actions']) {
            this.allColumns = this.datatable['ngx-datatable-actions'];
        }
    }
    /**
     * @param {?} column
     * @return {?}
     */
    toggleVisible(column) {
        column['visible'] = !column['visible'];
        this.setTableColumn();
    }
    /**
     * @param {?} column
     * @return {?}
     */
    pinningVisible(column) {
        column['fixed'] = !column['fixed'];
        this.allColumns[this.allColumns.indexOf(column)].frozenLeft = column['fixed'];
        this.setTableColumn();
    }
    /**
     * @private
     * @return {?}
     */
    setTableColumn() {
        /** @type {?} */
        const columns = this.allColumns.filter(c => {
            return c['visible'];
        });
        this.datatable.columns = columns;
        this.datatable['ngx-datatable-actions'] = this.allColumns;
        if (this.cacheData === true) {
            this.cacheColumn();
        }
    }
    /**
     * @private
     * @return {?}
     */
    loadCacheData() {
        /** @type {?} */
        let vcns = [];
        /** @type {?} */
        let fcns = [];
        /** @type {?} */
        const cache = sessionStorage.getItem(this.router.url + '|dt');
        if (cache != null) {
            /** @type {?} */
            const colns = JSON.parse(cache);
            vcns = colns[0].split(',');
            fcns = colns[1].split(',');
            this.allColumns.forEach(c => {
                if (vcns.length > 0 && c.name && vcns.indexOf(c.name) === -1) {
                    c['visible'] = false;
                }
                if (fcns.length > 0 && fcns.indexOf(c.name) > -1) {
                    c['fixed'] = true;
                    c.frozenLeft = true;
                }
            });
        }
        this.setTableColumn();
    }
    /**
     * @private
     * @return {?}
     */
    cacheColumn() {
        /** @type {?} */
        const vcol = [];
        /** @type {?} */
        const fcol = [];
        /** @type {?} */
        const columns = this.allColumns.filter(c => {
            return (c['visible'] || c['fixed']) && c.name;
        });
        columns.forEach(c => {
            if (c['visible']) {
                vcol.push(c.name);
            }
            if (c['fixed']) {
                fcol.push(c.name);
            }
        });
        if (vcol || fcol) {
            /** @type {?} */
            const value = JSON.stringify([vcol.join(','), fcol.join(',')]);
            sessionStorage.setItem(this.router.url + '|dt', value);
        }
        else {
            sessionStorage.removeItem(this.router.url + '|dt');
        }
    }
}
NgxDatatableActionsComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-datatable-actions',
                template: `
  <div class="dropdown d-inline">
    <a href="#" class="btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill"
      data-toggle="dropdown" aria-expanded="false">
      <i class="la la-ellipsis-h"></i>
    </a>
    <div class="dropdown-menu dropdown-menu-right" x-placement="bottom-end">
      <ng-container *ngFor="let col of allColumns">
        <div *ngIf="col.name && col.name!=null && col.name!=''" class="dropdown-item">
          <a class="m-link" title="可见" (click)="toggleVisible(col)">
            <i class="la la-check" [ngClass]="{'m--font-focus': col['visible'], 'm--font-metal': !col['visible']}"></i>
          </a>
          <a class="m-link" title="固定" (click)="pinningVisible(col)">
            <i class="la la-thumb-tack" [ngClass]="{'m--font-focus': col['fixed'], 'm--font-metal': !col['fixed']}"></i>
          </a>
          <span class="inline">{{col.name}}</span>
        </div>
      </ng-container>
    </div>
  </div>`
            }] }
];
/** @nocollapse */
NgxDatatableActionsComponent.ctorParameters = () => [
    { type: Router }
];
NgxDatatableActionsComponent.propDecorators = {
    datatable: [{ type: Input }],
    visibleColumns: [{ type: Input }],
    cacheData: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NgxDatatableActionsComponent.prototype.datatable;
    /** @type {?} */
    NgxDatatableActionsComponent.prototype.visibleColumns;
    /** @type {?} */
    NgxDatatableActionsComponent.prototype.cacheData;
    /** @type {?} */
    NgxDatatableActionsComponent.prototype.allColumns;
    /**
     * @type {?}
     * @private
     */
    NgxDatatableActionsComponent.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWRhdGF0YWJsZS1hY3Rpb25zLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1kYXRhdGFibGUtYWN0aW9ucy8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtZGF0YXRhYmxlLWFjdGlvbnMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBb0IsTUFBTSxlQUFlLENBQUM7QUFDM0UsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBeUJ6QyxNQUFNLE9BQU8sNEJBQTRCOzs7O0lBT3ZDLFlBQW9CLE1BQWM7UUFBZCxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBTHpCLG1CQUFjLEdBQWEsRUFBRSxDQUFDO1FBQzlCLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFFM0IsZUFBVSxHQUFVLEVBQUUsQ0FBQztJQUVlLENBQUM7Ozs7SUFFdkMsUUFBUTtRQUNOLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLHVCQUF1QixDQUFDLEVBQUU7WUFDN0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHVCQUF1QixDQUFDLENBQUM7U0FDM0Q7YUFBTTtZQUNMLEtBQUssTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFO2dCQUN0RCxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDO2dCQUN0QixHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDO2dCQUVyQixJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO29CQUNuQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxFQUFFO3dCQUNyQixHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDO3FCQUN4QjtnQkFDSCxDQUFDLENBQUMs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UUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O1NBbUJIO2FBQ1I7Ozs7WUF4QlEsTUFBTTs7O3dCQTBCWixLQUFLOzZCQUNMLEtBQUs7d0JBQ0wsS0FBSzs7OztJQUZOLGlEQUF3Qjs7SUFDeEIsc0RBQXVDOztJQUN2QyxpREFBMkI7O0lBRTNCLGtEQUF1Qjs7Ozs7SUFFWCw4Q0FBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEFmdGVyVmlld0NoZWNrZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FwcC1kYXRhdGFibGUtYWN0aW9ucycsXG4gIHRlbXBsYXRlOiBgXG4gIDxkaXYgY2xhc3M9XCJkcm9wZG93biBkLWlubGluZVwiPlxuICAgIDxhIGhyZWY9XCIjXCIgY2xhc3M9XCJidG4gbS1idG4gbS1idG4tLWhvdmVyLWJyYW5kIG0tYnRuLS1pY29uIG0tYnRuLS1pY29uLW9ubHkgbS1idG4tLXBpbGxcIlxuICAgICAgZGF0YS10b2dnbGU9XCJkcm9wZG93blwiIGFyaWEtZXhwYW5kZWQ9XCJmYWxzZVwiPlxuICAgICAgPGkgY2xhc3M9XCJsYSBsYS1lbGxpcHNpcy1oXCI+PC9pPlxuICAgIDwvYT5cbiAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd24tbWVudSBkcm9wZG93bi1tZW51LXJpZ2h0XCIgeC1wbGFjZW1lbnQ9XCJib3R0b20tZW5kXCI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBjb2wgb2YgYWxsQ29sdW1uc1wiPlxuICAgICAgICA8ZGl2ICpuZ0lmPVwiY29sLm5hbWUgJiYgY29sLm5hbWUhPW51bGwgJiYgY29sLm5hbWUhPScnXCIgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCI+XG4gICAgICAgICAgPGEgY2xhc3M9XCJtLWxpbmtcIiB0aXRsZT1cIuWPr+ingVwiIChjbGljayk9XCJ0b2dnbGVWaXNpYmxlKGNvbClcIj5cbiAgICAgICAgICAgIDxpIGNsYXNzPVwibGEgbGEtY2hlY2tcIiBbbmdDbGFzc109XCJ7J20tLWZvbnQtZm9jdXMnOiBjb2xbJ3Zpc2libGUnXSwgJ20tLWZvbnQtbWV0YWwnOiAhY29sWyd2aXNpYmxlJ119XCI+PC9pPlxuICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8YSBjbGFzcz1cIm0tbGlua1wiIHRpdGxlPVwi5Zu65a6aXCIgKGNsaWNrKT1cInBpbm5pbmdWaXNpYmxlKGNvbClcIj5cbiAgICAgICAgICAgIDxpIGNsYXNzPVwibGEgbGEtdGh1bWItdGFja1wiIFtuZ0NsYXNzXT1cInsnbS0tZm9udC1mb2N1cyc6IGNvbFsnZml4ZWQnXSwgJ20tLWZvbnQtbWV0YWwnOiAhY29sWydmaXhlZCddfVwiPjwvaT5cbiAgICAgICAgICA8L2E+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJpbmxpbmVcIj57e2NvbC5uYW1lfX08L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9kaXY+XG4gIDwvZGl2PmBcbn0pXG5leHBvcnQgY2xhc3MgTmd4RGF0YXRhYmxlQWN0aW9uc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCB7XG4gIEBJbnB1dCgpIGRhdGF0YWJsZTogYW55O1xuICBASW5wdXQoKSB2aXNpYmxlQ29sdW1uczogc3RyaW5nW10gPSBbXTtcbiAgQElucHV0KCkgY2FjaGVEYXRhID0gZmFsc2U7XG5cbiAgYWxsQ29sdW1uczogYW55W10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlcjogUm91dGVyKSB7IH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodGhpcy5kYXRhdGFibGUgJiYgdGhpcy5kYXRhdGFibGVbJ25neC1kYXRhdGFibGUtYWN0aW9ucyddKSB7XG4gICAgICB0aGlzLmFsbENvbHVtbnMgPSB0aGlzLmRhdGF0YWJsZVsnbmd4LWRhdGF0YWJsZS1hY3Rpb25zJ107XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAoY29uc3QgY29sIG9mIHRoaXMuZGF0YXRhYmxlLmJvZHlDb21wb25lbnQuY29sdW1ucykge1xuICAgICAgICBjb2xbJ3Zpc2libGUnXSA9IHRydWU7XG4gICAgICAgIGNvbFsnZml4ZWQnXSA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMudmlzaWJsZUNvbHVtbnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgIGlmIChjb2wucHJvcCA9PT0gaXRlbSkge1xuICAgICAgICAgICAgY29sWyd2aXNpYmxlJ10gPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWxsQ29sdW1ucy5wdXNoKGNvbCk7XG4gICAgICB9XG4gICAgICB0aGlzLnNldFRhYmxlQ29sdW1uKCk7XG4gICAgICBpZiAodGhpcy5jYWNoZURhdGEgPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy5sb2FkQ2FjaGVEYXRhKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIGlmICh0aGlzLmRhdGF0YWJsZSAmJiB0aGlzLmRhdGF0YWJsZVsnbmd4LWRhdGF0YWJsZS1hY3Rpb25zJ10pIHtcbiAgICAgIHRoaXMuYWxsQ29sdW1ucyA9IHRoaXMuZGF0YXRhYmxlWyduZ3gtZGF0YXRhYmxlLWFjdGlvbnMnXTtcbiAgICB9XG4gIH1cblxuICB0b2dnbGVWaXNpYmxlKGNvbHVtbjogYW55KTogdm9pZCB7XG4gICAgY29sdW1uWyd2aXNpYmxlJ10gPSAhY29sdW1uWyd2aXNpYmxlJ107XG4gICAgdGhpcy5zZXRUYWJsZUNvbHVtbigpO1xuICB9XG5cbiAgcGlubmluZ1Zpc2libGUoY29sdW1uOiBhbnkpOiB2b2lkIHtcbiAgICBjb2x1bW5bJ2ZpeGVkJ10gPSAhY29sdW1uWydmaXhlZCddO1xuICAgIHRoaXMuYWxsQ29sdW1uc1t0aGlzLmFsbENvbHVtbnMuaW5kZXhPZihjb2x1bW4pXS5mcm96ZW5MZWZ0ID0gY29sdW1uWydmaXhlZCddO1xuICAgIHRoaXMuc2V0VGFibGVDb2x1bW4oKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VGFibGVDb2x1bW4oKSB7XG4gICAgY29uc3QgY29sdW1ucyA9IHRoaXMuYWxsQ29sdW1ucy5maWx0ZXIoYyA9PiB7XG4gICAgICByZXR1cm4gY1sndmlzaWJsZSddO1xuICAgIH0pO1xuICAgIHRoaXMuZGF0YXRhYmxlLmNvbHVtbnMgPSBjb2x1bW5zO1xuICAgIHRoaXMuZGF0YXRhYmxlWyduZ3gtZGF0YXRhYmxlLWFjdGlvbnMnXSA9IHRoaXMuYWxsQ29sdW1ucztcbiAgICBpZiAodGhpcy5jYWNoZURhdGEgPT09IHRydWUpIHtcbiAgICAgIHRoaXMuY2FjaGVDb2x1bW4oKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGxvYWRDYWNoZURhdGEoKSB7XG4gICAgbGV0IHZjbnM6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IGZjbnM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgY2FjaGUgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHRoaXMucm91dGVyLnVybCArICd8ZHQnKTtcbiAgICBpZiAoY2FjaGUgIT0gbnVsbCkge1xuICAgICAgY29uc3QgY29sbnMgPSBKU09OLnBhcnNlKGNhY2hlKTtcbiAgICAgIHZjbnMgPSBjb2xuc1swXS5zcGxpdCgnLCcpO1xuICAgICAgZmNucyA9IGNvbG5zWzFdLnNwbGl0KCcsJyk7XG4gICAgICB0aGlzLmFsbENvbHVtbnMuZm9yRWFjaChjID0+IHtcbiAgICAgICAgaWYgKHZjbnMubGVuZ3RoID4gMCAmJiBjLm5hbWUgJiYgdmNucy5pbmRleE9mKGMubmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgY1sndmlzaWJsZSddID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZjbnMubGVuZ3RoID4gMCAmJiBmY25zLmluZGV4T2YoYy5uYW1lKSA+IC0xKSB7XG4gICAgICAgICAgY1snZml4ZWQnXSA9IHRydWU7XG4gICAgICAgICAgYy5mcm96ZW5MZWZ0ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuc2V0VGFibGVDb2x1bW4oKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FjaGVDb2x1bW4oKSB7XG4gICAgY29uc3QgdmNvbDogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBmY29sOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmFsbENvbHVtbnMuZmlsdGVyKGMgPT4ge1xuICAgICAgcmV0dXJuIChjWyd2aXNpYmxlJ10gfHwgY1snZml4ZWQnXSkgJiYgYy5uYW1lO1xuICAgIH0pO1xuICAgIGNvbHVtbnMuZm9yRWFjaChjID0+IHtcbiAgICAgIGlmIChjWyd2aXNpYmxlJ10pIHtcbiAgICAgICAgdmNvbC5wdXNoKGMubmFtZSk7XG4gICAgICB9XG4gICAgICBpZiAoY1snZml4ZWQnXSkge1xuICAgICAgICBmY29sLnB1c2goYy5uYW1lKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAodmNvbCB8fCBmY29sKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KFt2Y29sLmpvaW4oJywnKSwgZmNvbC5qb2luKCcsJyldKTtcbiAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0odGhpcy5yb3V0ZXIudXJsICsgJ3xkdCcsIHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLnJvdXRlci51cmwgKyAnfGR0Jyk7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==